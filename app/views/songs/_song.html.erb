<div class="song">
	<div class='image'>
		<%= image_tag song.album.cover_url, :width => '126' if song.album && song.album.cover_url %>
	</div>
	<div class='content'>
		<h3><%= link_to truncate(song.display_title), song %></h3>
		<% if song.artist %>
			<h5><%= truncate song.artist.name %></h5>
		<% end %>
		<% unless song.album.blank? %>
			<h5><%= truncate song.album.name %></h5>
		<% end %>
		<p>
			Play count: <%= song.play_count %>
		</p>
	</div>
	<div class='links'>
		<p>
			<% if defined?(item) %>
				<p>
					Queued by: <%= item.user.name if item.user %>
				</p>
			<% end %>
			<%= link_to '[download]', download_song_path(song) if can? :download, song %>
			<%= link_to '[edit]', edit_song_path(song) if can? :update, song %>
			<%= link_to '[destroy]', song, :method => :delete, :confirm => 'are you sure?' if can? :destroy, song %>

			<% if defined?(item) && can?(:destroy, item) %>
				<br/><%= link_to '[remove]', playlist_queue_item_path(@playlist, item), :class => 'remove' %>
			<% end %>
		</p>
		
		<% if @pool %>
			<%= link_to "[remove from pool]", remove_playlist_pool_path(@playlist) + '?' + {:song_id => song.id}.to_query, :class => 'pool-remove' if can? :remove_from, @pool %>
		<% end %>
		
		<% if @playlist.nil? %>
			<% playlists = Playlist.all %>
			<div class='add'>
				<%= link_to "[add to queue]", '#' %>
				<ul>
					<% playlists.each do |playlist| %>
					<% next if cannot? :add_to, playlist.pool %>
						<li>
							<%= link_to playlist.name, new_playlist_queue_item_path(playlist) + '?' + {:song_id => song.id}.to_query %>
						</li>
					<% end %>
				</ul>
			</div>
			<div class='add'>
				<%= link_to "[add to pool]", '#' %>
				<ul>
					<% playlists.each do |playlist| %>
						<% next if cannot?(:add_to, playlist.pool) || song.pools.include?(playlist.pool) %>
						<li>
							<%= link_to playlist.name, add_playlist_pool_path(playlist) + '?' + {:song_id => song.id}.to_query %>
						</li>
					<% end %>
				</ul>
			</div>
		<% end %>
	</div>
</div>