<% javascript 'rails', 'tabs' %>

<div class='tabs'>
  <ul>
    <li><a href="#queued">Queued</a></li>
    <li><a href="#current">Current</a></li>
    <li><a href="#finished">Finished</a></li>
    <li><a href="#failed">Failed</a></li>
    <% if can? :manage, Fargo %>
      <li><a href="#connections">Persistent Connections</a></li>
    <% end %>
  </ul>

  <div id='queued'>
    <%= render 'download_list', :downloads => @queued_downloads %>
  </div>

  <div id='current'>
    <table>
      <tr>
        <th>Nick</th>
        <th>File</th>
        <th>Size</th>
        <th>Progress</th>
      </tr>
      <% @current_downloads.each_pair do |nick, download| %>
        <tr>
          <td><%= nick %></td>
          <td><%= download.file %></td>
          <td><%= number_to_human_size download.size %></td>
          <td><%= number_to_percentage download.percent * 100 %></td>
        </tr>
      <% end %>
    </table>
  </div>

  <div id='finished'>
    <%= link_to "[Clear these]", :controller => 'fargo/commands', :action => "clear_finished_downloads" if can? :manage, Fargo %>
    <%= render 'download_list', :downloads => @finished_downloads %>
  </div>

  <div id='failed'>
    <%= link_to "[Clear these]", :controller => 'fargo/commands', :action => "clear_failed_downloads" if can? :manage, Fargo %>
    <%= render 'download_list', :downloads => @failed_downloads, :failed => true %>
  </div>

  <% if can? :manage, Fargo %>
    <div id='connections'>
      <table>
        <tr>
          <th>Nick</th>
          <th>Action</th>
        </tr>
        <tr>
          <td colspan='2' class='header'>
            Persistent
          </td>
        </tr>
        <% @connections.each do |nick| %>
          <tr class='remove'>
            <td><%= nick %></td>
            <td>
              <%= link_to "Disconnect", {:controller => 'fargo/commands', :action => :disconnect, :nick => nick}, :class => 'disconnect remote-remove' %>
            </td>
          </tr>
        <% end %>
        <tr>
          <td colspan='2' class='header'>
            Timed Out
          </td>
        </tr>
        <% @timed_out.each do |nick| %>
          <tr class='timeout remove'>
            <td><%= nick %></td>
            <td>
              <%= link_to "Try again", {:controller => 'fargo/downloads', :action => :try, :nick => nick}, :class => 'remote-remove' %>
            </td>
          </tr>
        <% end %>
      </table>
    </div>
  <% end %>
</div>
